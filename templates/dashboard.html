{% extends "base.html" %}
{% block content %}
<div style="margin-top: 80px; min-height: calc(100vh - 80px);">
    <div class="innovative-design">
        <!-- Header Section -->
        <header class="documentation-hero" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; padding: 2.5rem 0; margin-bottom: 2rem;">
            <div class="container">
                <div class="documentation-nav" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <a href="{{ url_for('project_detail', project_id=project.id) }}" class="back-button-innovative" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 0.6rem 1.2rem; border-radius: 50px; text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.3);">
                        <i class="fas fa-arrow-left"></i> Volver al Proyecto
                    </a>
                    <div class="documentation-actions">
                        {% if project.dashboard_url %}
                        <a href="{{ project.dashboard_url }}" target="_blank" class="download-button" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 0.6rem 1.2rem; border-radius: 50px; text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.3);">
                            <i class="fas fa-external-link-alt"></i> Abrir en nueva pestaña
                        </a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="documentation-header-content" style="text-align: center;">
                    <h1 class="documentation-title" style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">{{ project.title }}</h1>
                    <p class="documentation-section" style="font-size: 1.2rem; opacity: 0.9;">Dashboard Interactivo</p>
                </div>
            </div>
        </header>

        <!-- Dashboard Viewer Section -->
        <main class="container">
            {% if project.dashboard_url %}
            <div class="dashboard-viewer-container" style="background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); overflow: hidden; margin-bottom: 2rem;">
                <!-- Controles del Dashboard -->
                <div class="dashboard-controls" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                    <div class="dashboard-info">
                        <span style="font-weight: 500;">Visualizando: Dashboard de {{ project.title }}</span>
                    </div>
                    <div class="dashboard-actions">
                        <a href="{{ project.dashboard_url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-external-link-alt"></i> Abrir en Power BI
                        </a>
                    </div>
                </div>
                
                <!-- Contenedor del Dashboard -->
                <div class="dashboard-viewer" style="width: 100%; height: 75vh; min-height: 600px; position: relative;">
                    <iframe 
                        id="dashboard-iframe" 
                        src="{{ project.dashboard_url }}"
                        width="100%" 
                        height="100%" 
                        frameborder="0"
                        style="border: none;"
                        allowfullscreen
                        onload="hideLoading()">
                    </iframe>
                    
                    <!-- Overlay de carga -->
                    <div id="dashboard-loading" class="dashboard-loading" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; flex-direction: column;">
                        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem; margin-bottom: 1rem;"></div>
                        <p>Cargando dashboard...</p>
                    </div>
                </div>
            </div>
            
            <!-- Información adicional -->
            <div class="dashboard-additional-info" style="background: #f8f9fa; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                <h5 style="margin-bottom: 1rem;">Información del Dashboard</h5>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Proyecto:</strong> {{ project.title }}</p>
                        <p><strong>Tipo:</strong> Dashboard Interactivo</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Herramienta:</strong> Microsoft Power BI</p>
                        <p><strong>Actualizado:</strong> {% if project.date_created %}{{ project.date_created.strftime('%d/%m/%Y') }}{% else %}Reciente{% endif %}</p>
                    </div>
                </div>
            </div>
            
            <!-- Acciones adicionales -->
            <div class="dashboard-alternative-actions" style="text-align: center; padding: 1.5rem; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);">
                <p>Para una experiencia óptima con el dashboard:</p>
                <div class="action-buttons" style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem;">
                    <a href="{{ project.dashboard_url }}" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Abrir en pantalla completa
                    </a>
                    {% if project.github_url %}
                    <a href="{{ project.github_url }}" target="_blank" class="btn btn-outline-primary">
                        <i class="fab fa-github"></i> Ver código fuente
                    </a>
                    {% endif %}
                </div>
            </div>
            
            {% else %}
            <!-- Mensaje si no hay dashboard disponible -->
            <div class="no-dashboard-message" style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 12px;">
                <i class="fas fa-chart-bar" style="font-size: 3rem; color: #6c757d; margin-bottom: 1rem;"></i>
                <h3>Dashboard no disponible</h3>
                <p>Este proyecto no tiene un dashboard asociado en este momento.</p>
                <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Volver al proyecto
                </a>
            </div>
            {% endif %}
        </main>
    </div>
</div>

<!-- Script para manejar la carga del dashboard -->
<script>
// Función para ocultar el overlay de carga
function hideLoading() {
    const loadingOverlay = document.getElementById('dashboard-loading');
    if (loadingOverlay) {
        // Esperar un poco para asegurar que el dashboard está cargado
        setTimeout(function() {
            loadingOverlay.style.opacity = '0';
            setTimeout(function() {
                loadingOverlay.style.display = 'none';
            }, 500);
        }, 2000);
    }
}

// Inicializar cuando el documento esté listo
document.addEventListener('DOMContentLoaded', function() {
    // Configurar timeout de seguridad para ocultar el loading
    setTimeout(function() {
        hideLoading();
    }, 10000); // Ocultar después de 10 segundos como máximo
    
    // Efectos hover para botones
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('mouseenter', () => {
            button.style.transform = 'translateY(-2px)';
            button.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
        });
        button.addEventListener('mouseleave', () => {
            button.style.transform = 'translateY(0)';
            button.style.boxShadow = 'none';
        });
    });
    
    // Ajustar altura del iframe en dispositivos móviles
    function adjustIframeHeight() {
        const iframe = document.getElementById('dashboard-iframe');
        const viewer = document.querySelector('.dashboard-viewer');
        if (window.innerWidth < 768) {
            viewer.style.height = '60vh';
        } else {
            viewer.style.height = '75vh';
        }
    }
    
    // Ajustar inicialmente y en redimensionamiento
    adjustIframeHeight();
    window.addEventListener('resize', adjustIframeHeight);
});

// Función para forzar la ocultación del loading
window.forceHideLoading = function() {
    const loadingOverlay = document.getElementById('dashboard-loading');
    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }
}
</script>

<!-- Estilos adicionales -->
<style>
.back-button-innovative:hover,
.download-button:hover {
    background: rgba(255, 255, 255, 0.3) !important;
    transform: translateY(-2px);
}

.dashboard-viewer-container {
    transition: all 0.3s ease;
}

.dashboard-viewer-container:hover {
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15) !important;
}

.btn {
    transition: all 0.3s ease;
    border-radius: 50px;
    padding: 0.5rem 1.5rem;
}

.dashboard-loading {
    transition: opacity 0.5s ease;
}

@media (max-width: 768px) {
    .documentation-nav {
        flex-direction: column;
        gap: 1rem;
    }
    
    .documentation-title {
        font-size: 2rem !important;
    }
    
    .dashboard-viewer {
        min-height: 400px !important;
        height: 60vh !important;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .dashboard-controls {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
}
</style>
{% endblock %}
